<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Patronos - UAGM</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<!-- Scripts Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #c8102e 0%, #8b0b1f 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header img {
            position: absolute;
            height: 80px;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .header-content {
            padding-left: 100px;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .form-container {
            padding: 40px;
        }
        
        .section-title {
            font-size: 20px;
            color: #c8102e;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #c8102e;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        .required {
            color: #dc3545;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #c8102e;
            box-shadow: 0 0 0 3px rgba(200, 16, 46, 0.1);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .checkbox-item:hover {
            background: #e9ecef;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
            transform: scale(1.2);
        }
        
        .checkbox-item label {
            margin: 0;
            font-weight: normal;
            cursor: pointer;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: #c8102e;
            color: white;
        }
        
        .btn-primary:hover {
            background: #a00d26;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e2e8f0;
        }
        
        .success-message {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            display: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #c8102e;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .help-text {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header img {
                display: none;
            }
            
            .header-content {
                padding-left: 0;
            }
            
            .form-container {
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-btn" onclick="goBack()">
                <i class="fas fa-arrow-left"></i> Volver
            </button>
            <img src="logo blanco.png" alt="UAGM Logo">
            <div class="header-content">
                <h1><i class="fas fa-building"></i> Portal para Patronos</h1>
                <p>Publica tu oferta de empleo</p>
                <p>Todas las requisiciones serán atendidas según el orden que se reciban. Es importante que el patrono notifique acerca del proceso realizado con cada participante referido. Para mayor información puede comunicarse con la Oficina de Carreras y Colocaciones del Recinto de Cupey al teléfono, 787-766-1717 ext. 3662 / 3470. o al correo electrónico: brgonzalez@uagm.edu</p>
            </div>
        </div>

        <div class="form-container">
            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle" style="font-size: 24px; margin-bottom: 10px;"></i>
                <h3>¡Oferta Publicada Exitosamente!</h3>
                <p>Tu oferta de empleo ha sido registrada y estará disponible para los participantes.</p>
            </div>

            <div class="loading" id="loadingMessage">
                <div class="spinner"></div>
                <p>Publicando oferta de empleo...</p>
            </div>

            <form id="offerForm">
                <!-- Información General -->
                <div class="section-title">
                    <i class="fas fa-info-circle"></i>
                    Información General
                </div>

                <div class="form-group">
                    <label>Fecha de Hoy <span class="required">*</span></label>
                    <input type="date" id="today" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo de Patrono <span class="required">*</span></label>
                        <select id="patronType" required>
                            <option value="">Seleccionar...</option>
                            <option value="new">Patrono Nuevo</option>
                            <option value="existing">Patrono Existente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nombre de la Empresa <span class="required">*</span></label>
                        <input type="text" id="companyName" required placeholder="Ej: Microsoft Puerto Rico">
                    </div>
                </div>

                <!-- Información de Contacto -->
                <div class="section-title">
                    <i class="fas fa-address-card"></i>
                    Información de Contacto
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Persona Contacto <span class="required">*</span></label>
                        <input type="text" id="contactPerson" required placeholder="Nombre completo">
                    </div>
                    <div class="form-group">
                        <label>Posición que ocupa</label>
                        <input type="text" id="contactPosition" placeholder="Ej: Gerente de Recursos Humanos">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Teléfono <span class="required">*</span></label>
                        <input type="tel" id="phone" required placeholder="Ej: 787-555-1234">
                    </div>
                    <div class="form-group">
                        <label>Correo electrónico para referir candidatos <span class="required">*</span></label>
                        <input type="email" id="email" required placeholder="rrhh@empresa.com">
                    </div>
                </div>

                <div class="form-group">
                    <label>La oferta fue recibida a través de <span class="required">*</span></label>
                    <select id="receivedThrough" required>
                        <option value="">Seleccionar...</option>
                        <option value="email">Correo electrónico</option>
                        <option value="presencial">Presencial</option>
                        <option value="telefono">Teléfono</option>
                    </select>
                </div>

                <!-- Información del Puesto -->
                <div class="section-title">
                    <i class="fas fa-briefcase"></i>
                    Información del Puesto
                </div>

                <div class="form-group">
                    <label>Posición solicitada <span class="required">*</span></label>
                    <input type="text" id="position" required placeholder="Ej: Desarrollador Senior">
                </div>

                <div class="form-group">
                    <label>Descripción de Empleo</label>
                    <textarea id="jobDescription" placeholder="Describe las responsabilidades principales del puesto..."></textarea>
                </div>

                <div class="form-group">
                    <label>Horarios y días de trabajo</label>
                    <textarea id="schedule" placeholder="Ej: Lunes a Viernes, 8:00 AM - 5:00 PM"></textarea>
                </div>

                <div class="form-group">
                    <label>Requisitos de la posición <span class="required">*</span></label>
                    <textarea id="requirements" required placeholder="Ej: Bachillerato en Ingeniería, 3 años de experiencia..."></textarea>
                </div>

                <!-- Detalles del Empleo -->
                <div class="section-title">
                    <i class="fas fa-clipboard-list"></i>
                    Detalles del Empleo
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo de posición <span class="required">*</span></label>
                        <select id="positionType" required>
                            <option value="">Seleccionar...</option>
                            <option value="part-time">Part-Time</option>
                            <option value="full-time">Full-Time</option>
                            <option value="regular">Empleo regular</option>
                            <option value="temporary">Empleo temporero</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Salario a ofrecer <span class="required">*</span></label>
                        <input type="text" id="salary" required placeholder="Ej: $35,000 - $45,000 anuales">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Localización donde estará trabajando <span class="required">*</span></label>
                        <input type="text" id="location" required placeholder="Ej: San Juan, Puerto Rico">
                    </div>
                    <div class="form-group">
                        <label>Fecha límite para referir candidatos <span class="required">*</span></label>
                        <input type="date" id="deadline" required>
                        <div class="help-text">Fecha hasta cuando aceptarán candidatos</div>
                    </div>
                </div>

                <!-- Actividades de Reclutamiento -->
                <div class="section-title">
                    <i class="fas fa-handshake"></i>
                    Actividades de Reclutamiento
                </div>

                <div class="form-group">
                    <label>¿Te interesa participar en nuestras actividades de reclutamiento?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="feriaEmpleo" value="feria">
                            <label for="feriaEmpleo">Ferias de Empleo</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="mesasReclutamiento" value="mesas">
                            <label for="mesasReclutamiento">Mesas de reclutamiento</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="talleres" value="talleres">
                            <label for="talleres">Ofrecimiento de Talleres</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="noInteresa" value="no">
                            <label for="noInteresa">No me interesa participar de actividades</label>
                        </div>
                    </div>
                </div>

                <!-- Información Adicional -->
                <div class="section-title">
                    <i class="fas fa-plus-circle"></i>
                    Información Adicional
                </div>

                <div class="form-group">
                    <label>Notas Adicionales</label>
                    <textarea id="notes" placeholder="Cualquier información adicional que consideres importante..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">
                        <i class="fas fa-undo"></i> Limpiar Formulario
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> Publicar Oferta
                    </button>
                </div>
            </form>
        </div>
    </div>
<script>
        // Configuración Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBFgSuKNJMUoVcKgHjsqOsInArSPBsb32A",
            authDomain: "uagm-portal-de-empleo-17aed.firebaseapp.com",
            projectId: "uagm-portal-de-empleo-17aed",
            storageBucket: "uagm-portal-de-empleo-17aed.firebasestorage.app",
            messagingSenderId: "582147767835",
            appId: "1:582147767835:web:546ab8f2557b6da6ccc2be"
        };

        // Variables globales Firebase
        let app, db, auth, storage;
        let isFirebaseInitialized = false;

        function initializeFirebase() {
            try {
                app = firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                storage = firebase.storage();
                console.log('Firebase inicializado correctamente en patronos');
                return true;
            } catch (error) {
                console.error('Error inicializando Firebase:', error);
                return false;
            }
        }

        const FirebaseHelper = {
            async saveDoc(collection, data) {
                try {
                    const docRef = await db.collection(collection).add(data);
                    return { success: true, id: docRef.id };
                } catch (error) {
                    console.error('Error guardando documento:', error);
                    return { success: false, error };
                }
            }
        };

        // Inicializar cuando se carga la página
       document.addEventListener('DOMContentLoaded', function() {
            isFirebaseInitialized = initializeFirebase();
            document.getElementById('today').value = new Date().toISOString().split('T')[0];
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('deadline').min = today;
            console.log('Portal Patronos cargado correctamente');
        });

        // Volver a página principal
        function goBack() {
            window.location.href = 'Portal pagina principal.html';
        }

        // Limpiar formulario
        function resetForm() {
            if (confirm('¿Estás seguro que quieres limpiar todo el formulario?')) {
                document.getElementById('offerForm').reset();
                document.getElementById('today').value = new Date().toISOString().split('T')[0];
                showNotification('Formulario limpiado', 'info');
            }
        }

        // Manejar envío del formulario
        document.getElementById('offerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }

            submitOffer();
        });

        // Validar formulario
        function validateForm() {
            const requiredFields = [
                'today', 'patronType', 'companyName', 'contactPerson', 
                'phone', 'email', 'receivedThrough', 'position', 
                'requirements', 'positionType', 'salary', 'location', 'deadline'
            ];

            for (let fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.focus();
                    showNotification(`Por favor completa el campo: ${field.previousElementSibling.textContent}`, 'error');
                    return false;
                }
            }

            const email = document.getElementById('email').value;
            if (!isValidEmail(email)) {
                document.getElementById('email').focus();
                showNotification('Por favor ingresa un email válido', 'error');
                return false;
            }

            const deadline = new Date(document.getElementById('deadline').value);
            const today = new Date();
            if (deadline <= today) {
                document.getElementById('deadline').focus();
                showNotification('La fecha límite debe ser posterior a hoy', 'error');
                return false;
            }

            return true;
        }

        // Validar email
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

       // Enviar oferta a Firebase
        async function submitOffer() {
            document.getElementById('loadingMessage').style.display = 'block';
            document.querySelector('form').style.display = 'none';

            // Recopilar datos del formulario
            const offerData = {
                id: Date.now().toString(),
                today: document.getElementById('today').value,
                patronType: document.getElementById('patronType').value,
                companyName: document.getElementById('companyName').value,
                contactPerson: document.getElementById('contactPerson').value,
                contactPosition: document.getElementById('contactPosition').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                receivedThrough: document.getElementById('receivedThrough').value,
                position: document.getElementById('position').value,
                jobDescription: document.getElementById('jobDescription').value,
                schedule: document.getElementById('schedule').value,
                requirements: document.getElementById('requirements').value,
                positionType: document.getElementById('positionType').value,
                salary: document.getElementById('salary').value,
                location: document.getElementById('location').value,
                deadline: document.getElementById('deadline').value,
                notes: document.getElementById('notes').value,
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            // Recopilar actividades seleccionadas
            const activities = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                activities.push(checkbox.value);
            });
            offerData.activities = activities;

            try {
                // Intentar guardar en Firebase
                if (isFirebaseInitialized) {
                    const result = await FirebaseHelper.saveDoc('jobOffers', offerData);
                    if (result.success) {
                        console.log('Oferta guardada en Firebase:', result.id);
                        showNotification('¡Oferta publicada en Firebase!', 'success');
                    } else {
                        throw new Error('Error de Firebase');
                    }
                } else {
                    throw new Error('Firebase no inicializado');
                }
            } catch (error) {
                console.error('Error con Firebase, usando localStorage:', error);
                showNotification('Guardado localmente (Firebase falló)', 'warning');
            }

            // Guardar también en localStorage como respaldo
            saveOfferLocally(offerData);
            
            // Mostrar éxito
            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'block';
            showNotification('¡Oferta publicada exitosamente!', 'success');
            
            // Resetear formulario después de 3 segundos
            setTimeout(() => {
                document.getElementById('offerForm').reset();
                document.getElementById('today').value = new Date().toISOString().split('T')[0];
                document.getElementById('successMessage').style.display = 'none';
                document.querySelector('form').style.display = 'block';
            }, 3000);
        }

        // Guardar oferta localmente (respaldo)
        function saveOfferLocally(offerData) {
            // Generar ID único
            const dataWithId = { ...offerData, id: Date.now().toString() };
            
            let offers = JSON.parse(localStorage.getItem('jobOffers')) || [];
            offers.push(dataWithId);
            localStorage.setItem('jobOffers', JSON.stringify(offers));
            
            let patronOffers = JSON.parse(localStorage.getItem('patronOffers')) || [];
            patronOffers.push(dataWithId);
            localStorage.setItem('patronOffers', JSON.stringify(patronOffers));
        }

        // Sistema de notificaciones
        function showNotification(message, type = 'info') {
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                animation: slideInRight 0.3s ease;
                max-width: 350px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            
            const colors = {
                success: '#28a745',
                error: '#dc3545',
                warning: '#ffc107',
                info: '#17a2b8'
            };
            
            notification.style.backgroundColor = colors[type] || colors.info;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            notification.innerHTML = `
                <i class="${icons[type] || icons.info}" style="margin-right: 10px;"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }

        // Validación en tiempo real
        document.getElementById('email').addEventListener('blur', function() {
            if (this.value && !isValidEmail(this.value)) {
                this.style.borderColor = '#dc3545';
                showNotification('Formato de email inválido', 'warning');
            } else {
                this.style.borderColor = '#e2e8f0';
            }
        });

        document.getElementById('deadline').addEventListener('change', function() {
            const deadline = new Date(this.value);
            const today = new Date();
            if (deadline <= today) {
                this.style.borderColor = '#dc3545';
                showNotification('La fecha límite debe ser posterior a hoy', 'warning');
            } else {
                this.style.borderColor = '#e2e8f0';
            }
        });

        // Manejar checkbox "No me interesa"
        document.getElementById('noInteresa').addEventListener('change', function() {
            const otherCheckboxes = ['feriaEmpleo', 'mesasReclutamiento', 'talleres'];
            if (this.checked) {
                otherCheckboxes.forEach(id => {
                    document.getElementById(id).checked = false;
                });
            }
        });

        // Manejar otros checkboxes
        ['feriaEmpleo', 'mesasReclutamiento', 'talleres'].forEach(id => {
            document.getElementById(id).addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('noInteresa').checked = false;
                }
            });
        });

        // Hacer funciones globales
        window.goBack = goBack;
        window.resetForm = resetForm;

        // Agregar animaciones CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { 
                    transform: translateX(100%); 
                    opacity: 0; 
                }
                to { 
                    transform: translateX(0); 
                    opacity: 1; 
                }
            }
            
            @keyframes slideOutRight {
                from { 
                    transform: translateX(0); 
                    opacity: 1; 
                }
                to { 
                    transform: translateX(100%); 
                    opacity: 0; 
                }
            }

            .form-group input:invalid,
            .form-group select:invalid,
            .form-group textarea:invalid {
                border-color: #dc3545;
            }

            .form-group input:valid,
            .form-group select:valid,
            .form-group textarea:valid {
                border-color: #28a745;
            }

            .btn {
                position: relative;
                overflow: hidden;
            }

            .btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
                transition: left 0.5s;
            }

            .btn:hover::before {
                left: 100%;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
