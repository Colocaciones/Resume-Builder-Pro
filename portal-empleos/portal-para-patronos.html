<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Patronos - UAGM</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<!-- Scripts Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    background: white;
}
        
        .container {
    width: 100%;
    max-width: 100%;
    margin: 0;
    padding: 0;
    background: white;
}
        
       /* HERO SECTION PATRONOS */
.hero-section-patronos {
    position: relative;
    min-height: 40vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: url('https://images.unsplash.com/photo-1560179707-f14e90ef3623?w=1920') center/cover no-repeat;
    overflow: hidden;
}

.hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
}

.hero-content-patronos {
    position: relative;
    z-index: 10;
    text-align: center;
    color: white;
    padding: 40px;
    animation: fadeInUp 1s ease;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.hero-title-patronos {
    font-size: 42px;
    font-weight: 800;
    margin-bottom: 15px;
    text-shadow: 2px 2px 8px rgba(0,0,0,0.4);
    color: white;
}

.hero-tagline-patronos {
    font-size: 20px;
    font-weight: 300;
    text-shadow: 1px 1px 4px rgba(0,0,0,0.4);
    color: white;
}

.back-btn-hero {
    position: absolute;
    top: 20px;
    left: 20px;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.3);
    padding: 12px 20px;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
    z-index: 100;
}

.back-btn-hero:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateX(-5px);
}

/* Responsive Hero Patronos */
@media (max-width: 768px) {
    .hero-section-patronos {
        min-height: 35vh;
    }
    
    .hero-title-patronos {
        font-size: 28px;
    }
    
    .hero-tagline-patronos {
        font-size: 16px;
    }
}
        
        .form-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 60px 40px;
    background: white;
}
        
        .section-title {
    font-size: 24px;
    color: #c8102e;
    margin-bottom: 30px;
    margin-top: 40px;
    padding: 15px 20px;
    background: linear-gradient(135deg, rgba(200, 16, 46, 0.1) 0%, rgba(139, 11, 31, 0.05) 100%);
    border-left: 5px solid #c8102e;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 700;
}

.section-title i {
    font-size: 28px;
}
        
        .form-group {
    margin-bottom: 25px;
}

.form-group label {
    display: block;
    margin-bottom: 10px;
    font-weight: 600;
    color: #2d3748;
    font-size: 15px;
}

.required {
    color: #dc3545;
    font-size: 18px;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 14px 18px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 15px;
    transition: all 0.3s ease;
    background: white;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #c8102e;
    box-shadow: 0 0 0 4px rgba(200, 16, 46, 0.1);
    transform: translateY(-2px);
}

.form-group input:hover,
.form-group select:hover,
.form-group textarea:hover {
    border-color: #c8102e;
}

.form-group textarea {
    min-height: 120px;
    resize: vertical;
    line-height: 1.6;
}
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.checkbox-item:hover {
    background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
    border-color: #c8102e;
    transform: translateX(5px);
}
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
            transform: scale(1.2);
        }
        
        .checkbox-item label {
            margin: 0;
            font-weight: normal;
            cursor: pointer;
        }
        
        .btn {
    padding: 15px 35px;
    border: none;
    border-radius: 50px;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: inline-flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.btn-primary {
    background: linear-gradient(135deg, #c8102e 0%, #8b0b1f 100%);
    color: white;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #a00d26 0%, #6d0918 100%);
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(200, 16, 46, 0.4);
}

.btn-secondary {
    background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
    color: white;
}

.btn-secondary:hover {
    background: linear-gradient(135deg, #5a6268 0%, #495057 100%);
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
}
        
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e2e8f0;
        }
        
        .success-message {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    padding: 30px;
    border-radius: 20px;
    text-align: center;
    margin-bottom: 30px;
    display: none;
    box-shadow: 0 10px 30px rgba(40, 167, 69, 0.3);
    animation: successAppear 0.5s ease;
}

@keyframes successAppear {
    from {
        opacity: 0;
        transform: scale(0.9);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.success-message h3 {
    margin-top: 10px;
    margin-bottom: 10px;
    font-size: 24px;
}

.success-message p {
    font-size: 16px;
    margin: 0;
}

.loading {
    display: none;
    text-align: center;
    padding: 40px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 20px;
}

.spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #c8102e;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading p {
    font-size: 18px;
    color: #2d3748;
    font-weight: 600;
}
        
        .help-text {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
            font-style: italic;
        }

/* ===== ESTILOS PARA MÚLTIPLES OFERTAS ===== */

.patron-info-section {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 30px;
    border-radius: 20px;
    margin-bottom: 40px;
    border: 2px solid #dee2e6;
}

.offers-section {
    margin-top: 40px;
}

.offer-card-container {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 15px;
    margin-bottom: 20px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.offer-card-container:hover {
    border-color: #c8102e;
    box-shadow: 0 5px 20px rgba(200, 16, 46, 0.1);
}

.offer-card-header {
    background: linear-gradient(135deg, #c8102e 0%, #8b0b1f 100%);
    color: white;
    padding: 20px 25px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
}

.offer-card-header:hover {
    background: linear-gradient(135deg, #a00d26 0%, #6d0918 100%);
}

.offer-card-header h4 {
    margin: 0;
    font-size: 18px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.offer-card-header .toggle-icon {
    font-size: 20px;
    transition: transform 0.3s ease;
}

.offer-card-header .toggle-icon.collapsed {
    transform: rotate(-90deg);
}

.offer-card-actions {
    display: flex;
    gap: 10px;
    align-items: center;
}

.delete-offer-btn {
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: white;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
}

.delete-offer-btn:hover {
    background: rgba(220, 53, 69, 0.9);
    border-color: #dc3545;
    transform: scale(1.05);
}

.offer-card-body {
    padding: 30px 25px;
    display: none;
}

.offer-card-body.expanded {
    display: block;
}

.offer-number-badge {
    background: rgba(255, 255, 255, 0.2);
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
}

#offersSummary {
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.summary-item {
    background: white;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-left: 4px solid #339af0;
}

.summary-item strong {
    color: #1971c2;
}

.summary-item span {
    color: #495057;
    font-size: 14px;
}

#submitAllBtn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
}

#submitAllBtn:disabled:hover {
    transform: none;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.empty-offers-message {
    text-align: center;
    padding: 40px;
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border-radius: 15px;
    border: 2px dashed #ffc107;
    color: #856404;
}

.empty-offers-message i {
    font-size: 48px;
    margin-bottom: 15px;
    opacity: 0.6;
}

.empty-offers-message h3 {
    font-size: 20px;
    margin-bottom: 10px;
}

.empty-offers-message p {
    font-size: 14px;
    margin: 0;
}

/* Responsive para múltiples ofertas */
@media (max-width: 768px) {
    .patron-info-section {
        padding: 20px;
    }
    
    .offer-card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .offer-card-actions {
        width: 100%;
        justify-content: space-between;
    }
    
    .offer-card-body {
        padding: 20px 15px;
    }
}
        
        @media (max-width: 768px) {
    .container {
        margin: 0;
    }
    
    .form-container {
        padding: 30px 20px;
    }
    
    .section-title {
        font-size: 20px;
        padding: 12px 15px;
    }
    
    .section-title i {
        font-size: 22px;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .checkbox-group {
        grid-template-columns: 1fr;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
        justify-content: center;
    }
    
    .back-btn-hero {
        padding: 10px 15px;
        font-size: 14px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <!-- HERO SECTION -->
<div class="hero-section-patronos">
    <div class="hero-overlay"></div>
    <button class="back-btn-hero" onclick="goBack()">
        <i class="fas fa-arrow-left"></i> Volver al Portal Principal
    </button>
    <div class="hero-content-patronos">
        <h1 class="hero-title-patronos"><i class="fas fa-building"></i> Portal para Patronos</h1>
        <p class="hero-tagline-patronos">Publica tu oferta de empleo y conecta con talento calificado</p>
    </div>
</div>

        <div class="form-container">
            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle" style="font-size: 24px; margin-bottom: 10px;"></i>
                <h3>¡Oferta Publicada Exitosamente!</h3>
                <p>Tu oferta de empleo ha sido registrada y estará disponible para los participantes.</p>
            </div>

            <div class="loading" id="loadingMessage">
                <div class="spinner"></div>
                <p>Publicando oferta de empleo...</p>
            </div>

            <form id="offerForm">
    <!-- SECCIÓN 1: INFORMACIÓN DEL PATRONO (Se llena una sola vez) -->
    <div class="patron-info-section">
        <div class="section-title">
            <i class="fas fa-building"></i>
            Información del Patrono
            <span style="font-size: 14px; font-weight: 400; margin-left: 10px; color: #6c757d;">
                (Completa esta sección una sola vez)
            </span>
        </div>

        <div class="form-group">
            <label>Fecha de Hoy <span class="required">*</span></label>
            <input type="date" id="today" required>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Tipo de Patrono <span class="required">*</span></label>
                <select id="patronType" required>
                    <option value="">Seleccionar...</option>
                    <option value="new">Patrono Nuevo</option>
                    <option value="existing">Patrono Existente</option>
                </select>
            </div>
            <div class="form-group">
                <label>Nombre de la Empresa <span class="required">*</span></label>
                <input type="text" id="companyName" required placeholder="Ej: Microsoft Puerto Rico">
            </div>
        </div>

        <div class="section-title" style="margin-top: 20px;">
            <i class="fas fa-address-card"></i>
            Información de Contacto
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Persona Contacto <span class="required">*</span></label>
                <input type="text" id="contactPerson" required placeholder="Nombre completo">
            </div>
            <div class="form-group">
                <label>Posición que ocupa</label>
                <input type="text" id="contactPosition" placeholder="Ej: Gerente de Recursos Humanos">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Teléfono <span class="required">*</span></label>
                <input type="text" id="phone" required placeholder="787-555-1234" maxlength="12">
            </div>
            <div class="form-group">
                <label>Correo electrónico para referir candidatos <span class="required">*</span></label>
                <input type="email" id="email" required placeholder="rrhh@empresa.com">
            </div>
        </div>

        <div class="form-group">
            <label>La oferta fue recibida a través de <span class="required">*</span></label>
            <select id="receivedThrough" required>
                <option value="">Seleccionar...</option>
                <option value="email">Correo electrónico</option>
                <option value="presencial">Presencial</option>
                <option value="telefono">Teléfono</option>
            </select>
        </div>

        <div class="section-title" style="margin-top: 20px;">
            <i class="fas fa-handshake"></i>
            Actividades de Reclutamiento
        </div>

        <div class="form-group">
            <label>¿Te interesa participar en nuestras actividades de reclutamiento?</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="feriaEmpleo" value="feria">
                    <label for="feriaEmpleo">Ferias de Empleo</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="mesasReclutamiento" value="mesas">
                    <label for="mesasReclutamiento">Mesas de reclutamiento</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="talleres" value="talleres">
                    <label for="talleres">Ofrecimiento de Talleres</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="noInteresa" value="no">
                    <label for="noInteresa">No me interesa participar de actividades</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label>Notas Adicionales</label>
            <textarea id="notes" placeholder="Cualquier información adicional que consideres importante..."></textarea>
        </div>
    </div>

    <!-- SECCIÓN 2: OFERTAS DE EMPLEO (Múltiples) -->
    <div class="offers-section">
        <div class="section-title" style="background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(32, 201, 151, 0.05) 100%); border-left: 5px solid #28a745;">
            <i class="fas fa-briefcase"></i>
            Ofertas de Empleo
            <span style="font-size: 14px; font-weight: 400; margin-left: 10px; color: #6c757d;">
                (Puedes añadir múltiples posiciones)
            </span>
        </div>

        <div id="offersContainer">
            <!-- Las ofertas se añadirán aquí dinámicamente -->
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <button type="button" class="btn btn-secondary" onclick="addNewOffer()" id="addOfferBtn">
                <i class="fas fa-plus-circle"></i> Añadir Oferta de Empleo
            </button>
        </div>

        <!-- Resumen de ofertas añadidas -->
        <div id="offersSummary" style="display: none; background: #e7f5ff; border: 2px solid #339af0; border-radius: 15px; padding: 20px; margin: 20px 0;">
            <h4 style="color: #1971c2; margin-bottom: 15px;">
                <i class="fas fa-clipboard-list"></i> Resumen de Ofertas
            </h4>
            <div id="summaryList"></div>
        </div>
    </div>

    <div style="background: #f8f9fa; border-left: 4px solid #c8102e; padding: 20px; border-radius: 8px; margin-top: 30px;">
        <p style="color: #495057; line-height: 1.7; margin: 0; font-size: 14px;">
            <strong>Nota:</strong> Todas las requisiciones serán atendidas según el orden que se reciban. Es importante que el patrono notifique acerca del proceso realizado con cada participante referido. 
            Para mayor información puede comunicarse con la Oficina de Carreras y Colocaciones del Recinto de Cupey al teléfono <strong>787-766-1717 ext. 3662 / 3470</strong> o al correo electrónico: <strong>brgonzalez@uagm.edu</strong>
        </p>
    </div>

    <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="resetForm()">
            <i class="fas fa-undo"></i> Limpiar Todo
        </button>
        <button type="submit" class="btn btn-primary" id="submitAllBtn" disabled>
            <i class="fas fa-paper-plane"></i> Publicar Todas las Ofertas (<span id="offerCount">0</span>)
        </button>
    </div>
</form>
        </div>
    </div>
<script>
        // Configuración Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBFgSuKNJMUoVcKgHjsqOsInArSPBsb32A",
            authDomain: "uagm-portal-de-empleo-17aed.firebaseapp.com",
            projectId: "uagm-portal-de-empleo-17aed",
            storageBucket: "uagm-portal-de-empleo-17aed.firebasestorage.app",
            messagingSenderId: "582147767835",
            appId: "1:582147767835:web:546ab8f2557b6da6ccc2be"
        };

        // Variables globales Firebase
        let app, db, auth, storage;
        let isFirebaseInitialized = false;

        function initializeFirebase() {
            try {
                app = firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                storage = firebase.storage();
                console.log('Firebase inicializado correctamente en patronos');
                return true;
            } catch (error) {
                console.error('Error inicializando Firebase:', error);
                return false;
            }
        }

        const FirebaseHelper = {
            async saveDoc(collection, data) {
                try {
                    const docRef = await db.collection(collection).add(data);
                    return { success: true, id: docRef.id };
                } catch (error) {
                    console.error('Error guardando documento:', error);
                    return { success: false, error };
                }
            }
        };

        // Variables globales para múltiples ofertas
        let offersArray = [];
        let offerCounter = 0;

        // Inicializar cuando se carga la página
        document.addEventListener('DOMContentLoaded', function() {
            isFirebaseInitialized = initializeFirebase();
            document.getElementById('today').value = new Date().toISOString().split('T')[0];
            setupPhoneFormatting();
            initializeMultipleOffers();
            console.log('Portal Patronos cargado correctamente');
        });

        // Inicializar sistema de múltiples ofertas
        function initializeMultipleOffers() {
            showEmptyOffersMessage();
            updateSubmitButton();
        }

        // Mostrar mensaje cuando no hay ofertas
        function showEmptyOffersMessage() {
            const container = document.getElementById('offersContainer');
            container.innerHTML = `
                <div class="empty-offers-message">
                    <i class="fas fa-briefcase"></i>
                    <h3>No has añadido ninguna oferta aún</h3>
                    <p>Haz clic en "Añadir Oferta de Empleo" para comenzar</p>
                </div>
            `;
        }

        // Añadir nueva oferta
        function addNewOffer() {
            offerCounter++;
            const offerId = `offer_${offerCounter}`;
            
            const offerCard = createOfferCard(offerId, offerCounter);
            
            const container = document.getElementById('offersContainer');
            
            // Remover mensaje vacío si existe
            const emptyMessage = container.querySelector('.empty-offers-message');
            if (emptyMessage) {
                emptyMessage.remove();
            }
            
            container.insertAdjacentHTML('beforeend', offerCard);
            
            // Añadir a array
            offersArray.push({
                id: offerId,
                number: offerCounter,
                data: {}
            });
            
            // Configurar eventos
            setupOfferEvents(offerId);
            
            // Actualizar botón y resumen
            updateSubmitButton();
            updateSummary();
            
            // Expandir automáticamente la nueva oferta
            toggleOfferCard(offerId);
            
            showNotification(`Oferta #${offerCounter} añadida`, 'success');
        }

        // Crear HTML de tarjeta de oferta
        function createOfferCard(offerId, offerNumber) {
            const today = new Date().toISOString().split('T')[0];
            
            return `
                <div class="offer-card-container" id="${offerId}">
                    <div class="offer-card-header" onclick="toggleOfferCard('${offerId}')">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span class="offer-number-badge">Oferta #${offerNumber}</span>
                            <h4>
                                <i class="fas fa-briefcase"></i>
                                <span id="${offerId}_title">Nueva Oferta de Empleo</span>
                            </h4>
                        </div>
                        <div class="offer-card-actions">
                            <i class="fas fa-chevron-down toggle-icon" id="${offerId}_icon"></i>
                            <button type="button" class="delete-offer-btn" onclick="event.stopPropagation(); deleteOffer('${offerId}')">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </div>
                    </div>
                    
                    <div class="offer-card-body" id="${offerId}_body">
                        <div class="section-title" style="margin-top: 0;">
                            <i class="fas fa-briefcase"></i>
                            Información del Puesto
                        </div>

                        <div class="form-group">
                            <label>Posición solicitada <span class="required">*</span></label>
                            <input type="text" id="${offerId}_position" class="offer-input" data-offer="${offerId}" required placeholder="Ej: Desarrollador Senior">
                        </div>

                        <div class="form-group">
                            <label>Descripción de Empleo</label>
                            <textarea id="${offerId}_jobDescription" class="offer-input" data-offer="${offerId}" placeholder="Describe las responsabilidades principales del puesto..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Horarios y días de trabajo</label>
                            <textarea id="${offerId}_schedule" class="offer-input" data-offer="${offerId}" placeholder="Ej: Lunes a Viernes, 8:00 AM - 5:00 PM"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Requisitos de la posición <span class="required">*</span></label>
                            <textarea id="${offerId}_requirements" class="offer-input" data-offer="${offerId}" required placeholder="Ej: Bachillerato en Ingeniería, 3 años de experiencia..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Sector Industrial <span class="required">*</span></label>
                            <select id="${offerId}_academicDivision" class="offer-input" data-offer="${offerId}" required>
                                <option value="">Seleccionar...</option>
                                <option value="administracion">Administración</option>
                                <option value="finanzas">Finanzas</option>
                                <option value="salud">Salud</option>
                                <option value="ciencias">Ciencias</option>
                                <option value="tecnologia">Tecnología y Sistemas</option>
                                <option value="ventas">Ventas</option>
                                <option value="mercadeo">Mercadeo</option>
                                <option value="servicios">Servicios al Cliente</option>
                                <option value="operaciones">Operaciones y Logística</option>
                                <option value="ingenieria">Ingeniería y Manufactura</option>
                                <option value="hospitalidad">Hospitalidad y Turismo</option>
                                <option value="educacion">Educación</option>
                                <option value="todos">Todos los sectores</option>
                            </select>
                        </div>

                        <div class="section-title">
                            <i class="fas fa-clipboard-list"></i>
                            Detalles del Empleo
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Jornada de trabajo <span class="required">*</span></label>
                                <select id="${offerId}_workSchedule" class="offer-input" data-offer="${offerId}" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="part-time">Part-Time</option>
                                    <option value="full-time">Full-Time</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Tipo de empleo <span class="required">*</span></label>
                                <select id="${offerId}_employmentType" class="offer-input" data-offer="${offerId}" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="regular">Empleo Regular</option>
                                    <option value="temporary">Empleo Temporero</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Salario a ofrecer <span class="required">*</span></label>
                                <input type="text" id="${offerId}_salary" class="offer-input" data-offer="${offerId}" required placeholder="Ej: $35,000 - $45,000 anuales">
                            </div>
                            <div class="form-group">
                                <!-- Espacio vacío -->
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Localización donde estará trabajando <span class="required">*</span></label>
                                <input type="text" id="${offerId}_location" class="offer-input" data-offer="${offerId}" required placeholder="Ej: San Juan, Puerto Rico">
                            </div>
                            <div class="form-group">
                                <label>Fecha límite para referir candidatos <span class="required">*</span></label>
                                <input type="date" id="${offerId}_deadline" class="offer-input" data-offer="${offerId}" required min="${today}">
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Configurar eventos para una oferta
        function setupOfferEvents(offerId) {
            const inputs = document.querySelectorAll(`[data-offer="${offerId}"]`);
            
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    updateOfferData(offerId);
                    updateSummary();
                });
                
                input.addEventListener('change', function() {
                    updateOfferData(offerId);
                    updateSummary();
                });
            });
        }

        // Actualizar datos de una oferta
        function updateOfferData(offerId) {
            const offer = offersArray.find(o => o.id === offerId);
            if (!offer) return;
            
            offer.data = {
                position: document.getElementById(`${offerId}_position`)?.value || '',
                jobDescription: document.getElementById(`${offerId}_jobDescription`)?.value || '',
                schedule: document.getElementById(`${offerId}_schedule`)?.value || '',
                requirements: document.getElementById(`${offerId}_requirements`)?.value || '',
                academicDivision: document.getElementById(`${offerId}_academicDivision`)?.value || '',
                workSchedule: document.getElementById(`${offerId}_workSchedule`)?.value || '',
                employmentType: document.getElementById(`${offerId}_employmentType`)?.value || '',
                salary: document.getElementById(`${offerId}_salary`)?.value || '',
                location: document.getElementById(`${offerId}_location`)?.value || '',
                deadline: document.getElementById(`${offerId}_deadline`)?.value || ''
            };
            
            // Actualizar título de la tarjeta
            const position = offer.data.position || 'Nueva Oferta de Empleo';
            document.getElementById(`${offerId}_title`).textContent = position;
        }

        // Toggle expandir/colapsar oferta
        function toggleOfferCard(offerId) {
            const body = document.getElementById(`${offerId}_body`);
            const icon = document.getElementById(`${offerId}_icon`);
            
            body.classList.toggle('expanded');
            icon.classList.toggle('collapsed');
        }

        // Eliminar oferta
        function deleteOffer(offerId) {
            if (!confirm('¿Estás seguro de eliminar esta oferta?')) return;
            
            // Remover del DOM
            document.getElementById(offerId).remove();
            
            // Remover del array
            offersArray = offersArray.filter(o => o.id !== offerId);
            
            // Actualizar UI
            if (offersArray.length === 0) {
                showEmptyOffersMessage();
            }
            
            updateSubmitButton();
            updateSummary();
            
            showNotification('Oferta eliminada', 'info');
        }

        // Actualizar botón de envío
function updateSubmitButton() {
    const btn = document.getElementById('submitAllBtn');
    
    if (!btn) {
        console.error('Botón submitAllBtn no encontrado');
        return;
    }
    
    if (offersArray.length > 0) {
        btn.disabled = false;
        btn.innerHTML = `<i class="fas fa-paper-plane"></i> Publicar Todas las Ofertas (${offersArray.length})`;
    } else {
        btn.disabled = true;
        btn.innerHTML = `<i class="fas fa-paper-plane"></i> Publicar Todas las Ofertas (0)`;
    }
}

        // Actualizar resumen
        function updateSummary() {
            const summary = document.getElementById('offersSummary');
            const summaryList = document.getElementById('summaryList');
            
            if (offersArray.length === 0) {
                summary.style.display = 'none';
                return;
            }
            
            summary.style.display = 'block';
            
            let html = '';
            offersArray.forEach(offer => {
                const position = offer.data.position || 'Sin título';
                const location = offer.data.location || 'Sin ubicación';
                
                html += `
                    <div class="summary-item">
                        <div>
                            <strong>${position}</strong><br>
                            <span><i class="fas fa-map-marker-alt"></i> ${location}</span>
                        </div>
                        <span class="offer-number-badge" style="background: #339af0; color: white;">
                            Oferta #${offer.number}
                        </span>
                    </div>
                `;
            });
            
            summaryList.innerHTML = html;
        }

// Formatear teléfono automáticamente
function setupPhoneFormatting() {
    const phoneInput = document.getElementById('phone');
    
    phoneInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, ''); // Eliminar todo excepto números
        
        if (value.length > 3 && value.length <= 6) {
            value = value.slice(0, 3) + '-' + value.slice(3);
        } else if (value.length > 6) {
            value = value.slice(0, 3) + '-' + value.slice(3, 6) + '-' + value.slice(6, 10);
        }
        
        e.target.value = value;
    });
}

        // Volver a página principal
        function goBack() {
            window.location.href = 'Portal pagina principal.html';
        }

       // Limpiar formulario
        function resetForm() {
            if (confirm('¿Estás seguro que quieres limpiar todo el formulario y eliminar todas las ofertas?')) {
                // Limpiar formulario principal
                document.getElementById('offerForm').reset();
                document.getElementById('today').value = new Date().toISOString().split('T')[0];
                
                // Resetear ofertas
                offersArray = [];
                offerCounter = 0;
                document.getElementById('offersContainer').innerHTML = '';
                showEmptyOffersMessage();
                
                // Actualizar UI
                updateSubmitButton();
                document.getElementById('offersSummary').style.display = 'none';
                
                showNotification('Formulario limpiado completamente', 'info');
            }
        }

        // Manejar envío del formulario
        document.getElementById('offerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validatePatronForm()) {
                return;
            }

            if (!validateAllOffers()) {
                return;
            }

            submitAllOffers();
        });

        // Validar información del patrono
        function validatePatronForm() {
            const requiredFields = [
                'today', 'patronType', 'companyName', 'contactPerson', 
                'phone', 'email', 'receivedThrough'
            ];

            for (let fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.focus();
                    showNotification(`Por favor completa el campo: ${field.previousElementSibling.textContent}`, 'error');
                    return false;
                }
            }

            const email = document.getElementById('email').value;
            if (!isValidEmail(email)) {
                document.getElementById('email').focus();
                showNotification('Por favor ingresa un email válido', 'error');
                return false;
            }

            const phone = document.getElementById('phone').value;
            if (!isValidPhone(phone)) {
                document.getElementById('phone').focus();
                showNotification('Por favor ingresa un teléfono válido (formato: 787-555-1234)', 'error');
                return false;
            }

            return true;
        }

        // Validar todas las ofertas
        function validateAllOffers() {
            if (offersArray.length === 0) {
                showNotification('Debes añadir al menos una oferta de empleo', 'error');
                return false;
            }

            for (let offer of offersArray) {
                const offerId = offer.id;
                
                // Campos requeridos de cada oferta
                const requiredFields = [
                    { id: `${offerId}_position`, name: 'Posición' },
                    { id: `${offerId}_requirements`, name: 'Requisitos' },
                    { id: `${offerId}_academicDivision`, name: 'Sector Industrial' },
                    { id: `${offerId}_workSchedule`, name: 'Jornada de trabajo' },
                    { id: `${offerId}_employmentType`, name: 'Tipo de empleo' },
                    { id: `${offerId}_salary`, name: 'Salario' },
                    { id: `${offerId}_location`, name: 'Localización' },
                    { id: `${offerId}_deadline`, name: 'Fecha límite' }
                ];

                for (let field of requiredFields) {
                    const element = document.getElementById(field.id);
                    if (!element.value.trim()) {
                        // Expandir la oferta con error
                        const body = document.getElementById(`${offerId}_body`);
                        if (!body.classList.contains('expanded')) {
                            toggleOfferCard(offerId);
                        }
                        
                        element.focus();
                        showNotification(`Oferta #${offer.number}: Por favor completa "${field.name}"`, 'error');
                        return false;
                    }
                }

                // Validar fecha límite
                const deadline = new Date(document.getElementById(`${offerId}_deadline`).value);
                const today = new Date();
                if (deadline <= today) {
                    const body = document.getElementById(`${offerId}_body`);
                    if (!body.classList.contains('expanded')) {
                        toggleOfferCard(offerId);
                    }
                    
                    document.getElementById(`${offerId}_deadline`).focus();
                    showNotification(`Oferta #${offer.number}: La fecha límite debe ser posterior a hoy`, 'error');
                    return false;
                }
            }

            return true;
        }

        

        // Validar email
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

// Validar teléfono
function isValidPhone(phone) {
    // Acepta formatos: 787-555-1234 o 7875551234
    const phoneRegex = /^\d{3}-\d{3}-\d{4}$/;
    const phoneOnlyNumbers = /^\d{10}$/;
    return phoneRegex.test(phone) || phoneOnlyNumbers.test(phone.replace(/\D/g, ''));
}

       // Enviar todas las ofertas a Firebase
        async function submitAllOffers() {
            document.getElementById('loadingMessage').style.display = 'block';
            document.querySelector('form').style.display = 'none';

            // Actualizar mensaje de loading
            const loadingMsg = document.querySelector('.loading p');
            loadingMsg.textContent = `Publicando ${offersArray.length} oferta(s) de empleo...`;

            // Recopilar datos del patrono (común para todas las ofertas)
            const patronData = {
                today: document.getElementById('today').value,
                patronType: document.getElementById('patronType').value,
                companyName: document.getElementById('companyName').value,
                contactPerson: document.getElementById('contactPerson').value,
                contactPosition: document.getElementById('contactPosition').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                receivedThrough: document.getElementById('receivedThrough').value,
                notes: document.getElementById('notes').value
            };

            // Recopilar actividades seleccionadas
            const activities = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                activities.push(checkbox.value);
            });
            patronData.activities = activities;

            let successCount = 0;
            let errorCount = 0;
            const savedOffers = [];

            // Procesar cada oferta
            for (let offer of offersArray) {
                const offerData = {
                    id: Date.now().toString() + '_' + offer.number,
                    ...patronData, // Datos del patrono
                    position: offer.data.position,
                    jobDescription: offer.data.jobDescription,
                    schedule: offer.data.schedule,
                    requirements: offer.data.requirements,
                    academicDivision: offer.data.academicDivision,
                    workSchedule: offer.data.workSchedule,
                    employmentType: offer.data.employmentType,
                    salary: offer.data.salary,
                    location: offer.data.location,
                    deadline: offer.data.deadline,
                    status: 'active',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                try {
                    // Intentar guardar en Firebase
                    if (isFirebaseInitialized) {
                        const result = await FirebaseHelper.saveDoc('jobOffers', offerData);
                        if (result.success) {
                            console.log(`Oferta #${offer.number} guardada en Firebase:`, result.id);
                            successCount++;
                            savedOffers.push(offerData);
                        } else {
                            throw new Error('Error de Firebase');
                        }
                    } else {
                        throw new Error('Firebase no inicializado');
                    }
                } catch (error) {
                    console.error(`Error con Firebase para oferta #${offer.number}, usando localStorage:`, error);
                    errorCount++;
                    savedOffers.push(offerData);
                }

                // Guardar también en localStorage como respaldo
                saveOfferLocally(offerData);
            }

            // Mostrar mensaje de éxito
            document.getElementById('loadingMessage').style.display = 'none';
            const successMessage = document.getElementById('successMessage');
            
            if (successCount > 0) {
                successMessage.innerHTML = `
                    <i class="fas fa-check-circle" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <h3>¡${successCount} Oferta(s) Publicada(s) Exitosamente!</h3>
                    <p>Las ofertas de empleo han sido registradas y estarán disponibles para los participantes.</p>
                    ${errorCount > 0 ? `<p style="font-size: 14px; margin-top: 10px;">⚠️ ${errorCount} oferta(s) guardada(s) localmente</p>` : ''}
                `;
            } else {
                successMessage.innerHTML = `
                    <i class="fas fa-exclamation-triangle" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <h3>Ofertas Guardadas Localmente</h3>
                    <p>Las ${offersArray.length} ofertas se guardaron localmente (Firebase no disponible).</p>
                `;
                successMessage.style.background = 'linear-gradient(135deg, #ffc107 0%, #ff9800 100%)';
            }
            
            successMessage.style.display = 'block';
            
            showNotification(
                `✅ ${successCount} oferta(s) publicada(s) exitosamente`, 
                'success'
            );

            // Resetear formulario después de 3 segundos
            setTimeout(() => {
                resetForm();
                successMessage.style.display = 'none';
                successMessage.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                document.querySelector('form').style.display = 'block';
            }, 4000);
        }

        // Guardar oferta localmente (respaldo)
        function saveOfferLocally(offerData) {
            // Generar ID único
            const dataWithId = { ...offerData, id: Date.now().toString() };
            
            let offers = JSON.parse(localStorage.getItem('jobOffers')) || [];
            offers.push(dataWithId);
            localStorage.setItem('jobOffers', JSON.stringify(offers));
            
            let patronOffers = JSON.parse(localStorage.getItem('patronOffers')) || [];
            patronOffers.push(dataWithId);
            localStorage.setItem('patronOffers', JSON.stringify(patronOffers));
        }

        // Sistema de notificaciones
        function showNotification(message, type = 'info') {
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                animation: slideInRight 0.3s ease;
                max-width: 350px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            
            const colors = {
                success: '#28a745',
                error: '#dc3545',
                warning: '#ffc107',
                info: '#17a2b8'
            };
            
            notification.style.backgroundColor = colors[type] || colors.info;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            notification.innerHTML = `
                <i class="${icons[type] || icons.info}" style="margin-right: 10px;"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
        }

// Hacer funciones globales para el HTML
        window.addNewOffer = addNewOffer;
        window.toggleOfferCard = toggleOfferCard;
        window.deleteOffer = deleteOffer;

        // Validación en tiempo real
        document.getElementById('email').addEventListener('blur', function() {
            if (this.value && !isValidEmail(this.value)) {
                this.style.borderColor = '#dc3545';
                showNotification('Formato de email inválido', 'warning');
            } else {
                this.style.borderColor = '#e2e8f0';
            }
        });

        

        // Manejar checkbox "No me interesa"
        document.getElementById('noInteresa').addEventListener('change', function() {
            const otherCheckboxes = ['feriaEmpleo', 'mesasReclutamiento', 'talleres'];
            if (this.checked) {
                otherCheckboxes.forEach(id => {
                    document.getElementById(id).checked = false;
                });
            }
        });

        // Manejar otros checkboxes
        ['feriaEmpleo', 'mesasReclutamiento', 'talleres'].forEach(id => {
            document.getElementById(id).addEventListener('change', function() {
                if (this.checked) {
                    document.getElementById('noInteresa').checked = false;
                }
            });
        });

        // Hacer funciones globales
        window.goBack = goBack;
        window.resetForm = resetForm;

        // Agregar animaciones CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { 
                    transform: translateX(100%); 
                    opacity: 0; 
                }
                to { 
                    transform: translateX(0); 
                    opacity: 1; 
                }
            }
            
            @keyframes slideOutRight {
                from { 
                    transform: translateX(0); 
                    opacity: 1; 
                }
                to { 
                    transform: translateX(100%); 
                    opacity: 0; 
                }
            }

            .form-group input:invalid,
            .form-group select:invalid,
            .form-group textarea:invalid {
                border-color: #dc3545;
            }

            .form-group input:valid,
            .form-group select:valid,
            .form-group textarea:valid {
                border-color: #28a745;
            }

            .btn {
                position: relative;
                overflow: hidden;
            }

            .btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
                transition: left 0.5s;
            }

            .btn:hover::before {
                left: 100%;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
